<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Historique des Commandes</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6">
    <div th:replace="fragments/header :: body"></div>

    <div class="max-w-5xl mx-auto bg-white shadow rounded-xl p-8">
        <h1 class="text-3xl font-bold text-indigo-700 mb-6 text-center">Historique de vos commandes</h1>

        <div th:if="${commandes.isEmpty()}" class="text-gray-600 text-center">
            Aucune commande trouvée.
        </div>

        <div th:each="commande : ${commandes}" class="mb-6 border-b border-gray-200 pb-4">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">
                Commande du <span th:text="${#temporals.format(commande.dateCommande, 'dd/MM/yyyy HH:mm')}"></span>
            </h2>
            <p class="text-sm text-gray-600 mb-1"><strong>Pharmacie :</strong> <span th:text="${commande.pharmacy.nom}"></span></p>
            <p class="text-sm text-gray-600 mb-1"><strong>Offre :</strong> <span th:text="${commande.offre.nom}"></span></p>
            <p class="text-sm text-gray-600 mb-1"><strong>Total (après modif) :</strong> <span th:text="${#numbers.formatDecimal(commande.totalPrix, 1, 'COMMA', 2, 'POINT')} + ' DH'"></span></p>
            <p class="text-xs text-gray-500 mb-2" th:if="${commande.totalAvantModification != null}"><strong>Avant modif :</strong> <span th:text="${#numbers.formatDecimal(commande.totalAvantModification, 1, 'COMMA', 2, 'POINT')} + ' DH'"></span></p>
            <p class="text-sm text-gray-600 mb-2">
                <strong>Quantité :</strong> <span th:text="${commande.totalQuantite}"></span>
            </p>

            <table class="w-full text-sm border border-gray-300 mb-2">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="p-2 border">Produit</th>
                        <th class="p-2 border">Statut</th>
                        <th class="p-2 border">Quantité</th>
                        <th class="p-2 border">Prix Unitaire</th>
                        <th class="p-2 border">Sous-total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="ligne : ${commande.lignes}"
                        th:classappend="${ligne.statutProduit} == T(com.project.entity.LigneCommandeStatus).RUPTURE_STOCK ? ' opacity-50' : ''"
                        class="hover:bg-gray-50">
                        <td class="p-2 border" th:text="${ligne.produit != null ? ligne.produit.nom : '-'}"></td>
                        <td class="p-2 border">
                            <span class="inline-flex items-center rounded-full bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200 px-2 py-0.5 text-xs"
                                  th:if="${ligne.statutProduit} != T(com.project.entity.LigneCommandeStatus).RUPTURE_STOCK">Incluse</span>
                            <span class="inline-flex items-center rounded-full bg-amber-100 text-amber-800 ring-1 ring-amber-200 px-2 py-0.5 text-xs"
                                  th:if="${ligne.statutProduit} == T(com.project.entity.LigneCommandeStatus).RUPTURE_STOCK">Rupture</span>
                        </td>
                        <td class="p-2 border" th:text="${ligne.quantite}"></td>
                        <td class="p-2 border" th:text="${#numbers.formatDecimal(ligne.prixUnitaire, 1, 'COMMA', 2, 'POINT')} + ' DH'"></td>
                        <td class="p-2 border" th:text="${#numbers.formatDecimal(ligne.prixUnitaire * ligne.quantite, 1, 'COMMA', 2, 'POINT')} + ' DH'"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="text-center mt-6">
            <a th:href="@{/dashboard/client}" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Retour au tableau de bord</a>
        </div>
    </div>
</body>
</html>
